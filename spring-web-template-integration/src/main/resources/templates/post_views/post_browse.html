<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head th:replace="~{/fragments/head :: head}">
    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>

  <body>
    <header th:replace="~{/fragments/header :: header}"></header>

    <div class="container mt-5">
      <section sec:authorize="isAuthenticated()" class="mt-4">
        <div class="container">
          <div class="table-responsive">
            <table
              class="table table-hover align-middle shadow-sm rounded overflow-hidden"
            >
              <thead class="table-dark">
                <tr>
                  <th></th>
                  <th scope="col">Supplier ID</th>
                  <th scope="col">Supplier Name</th>
                  <th scope="col">Status</th>
                  <th scope="col">Created By</th>
                  <th scope="col">Description</th>
                </tr>
              </thead>
              <tbody class="bg-light">
                <tr th:each="post : ${posts}" class="border rounded-3">
                  <td>
                    <!-- Edit Icon -->
                    <a
                      th:href="@{'/edit_post/' + ${post.id}}"
                      class="text-decoration-none text-primary me-2"
                    >
                      <i class="fa-regular fa-pen-to-square"></i>
                    </a>

                    <!-- Delete Icon (with confirmation) -->
                    <a
                      href="#"
                      th:attr="data-id=${post.id}"
                      class="text-decoration-none text-danger delete-post"
                      sec:authorize="hasRole('ROLE_ADMIN')"
                    >
                      <i class="fa-regular fa-trash-can"></i>
                    </a>
                  </td>
                  <td th:text="${post.id}"></td>
                  <td>
                    <!-- Clickable Title -->
                    <a
                      th:href="@{'/post/' + ${post.id}}"
                      th:text="${post.title}"
                      class="fw-bold text-decoration-none text-dark"
                    >
                      Title
                    </a>
                  </td>
                  <td th:text="${post.status}"></td>
                  <td
                    th:text="${post.account.firstname}"
                    class="text-muted"
                  ></td>
                  <td th:utext="${post.body}"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <footer th:replace="~{/fragments/footer :: footer}"></footer>

    <!-- Delete Confirmation Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".delete-post").forEach((deleteBtn) => {
          deleteBtn.addEventListener("click", function (event) {
            event.preventDefault();
            const postId = this.getAttribute("data-id");
            if (confirm("Are you sure you want to delete the supplier?")) {
              window.location.href = "/delete_post/" + postId;
            }
          });
        });
      });
    </script>
  </body>
</html>
